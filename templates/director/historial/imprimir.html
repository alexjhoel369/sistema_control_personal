{% extends 'director/base.html' %}

{% block title %}Historial Laboral de {{ empleado.nombre }}{% endblock %}

{% block content %}
<h1 class="mb-4">Historial laboral de {{ empleado.nombre }} {{ empleado.apellido }}</h1>

<div class="card p-4 mb-4 bg-light border">
    <p><strong>CI:</strong> {{ empleado.ci }}</p>
    <p><strong>Email:</strong> {{ empleado.email }}</p>
    <p><strong>Teléfono:</strong> {{ empleado.telefono }}</p>
    <p><strong>Fecha de Registro:</strong> {{ empleado.fecha.strftime('%Y-%m-%d') }}</p>
    <p><strong>Cargo:</strong> {{ empleado.cargo.cargo if empleado.cargo else 'Sin cargo asignado' }}</p>
</div>

<h3>Usuarios vinculados:</h3>
{% if usuarios %}
<ul>
    {% for user in usuarios %}
    <li>{{ user.username }}</li>
    {% endfor %}
</ul>
{% else %}
<p>No hay usuarios vinculados.</p>
{% endif %}

{# Aquí eliminamos "Materias asignadas" porque ya no existe esa relación #}

<h3>Asistencias registradas:</h3>
{% if asistencias %}
<ul>
    {% for asistencia in asistencias %}
    <li>
        Fecha: {{ asistencia.fecha.strftime('%Y-%m-%d') if asistencia.fecha else 'Sin fecha' }},
        Entrada: {{ asistencia.hora_entrada.strftime('%H:%M') if asistencia.hora_entrada else 'N/A' }},
        Salida: {{ asistencia.hora_salida.strftime('%H:%M') if asistencia.hora_salida else 'N/A' }},
        Empleado: {{ asistencia.empleado.nombre }} {{ asistencia.empleado.apellido }}
    </li>
    {% endfor %}
</ul>
{% else %}
<p>No hay asistencias registradas.</p>
{% endif %}

<h3>Licencias aprobadas:</h3>
{% if licencias_aprobadas %}
<ul>
    {% for licencia in licencias_aprobadas %}
    <li>
        Fecha: {{ licencia.fecha_aprobacion.strftime('%Y-%m-%d') if licencia.fecha_aprobacion else 'Sin fecha' }},
        Tipo: {{ licencia.tipo_licencia.nombre if licencia.tipo_licencia else 'No definido' }},
        Estado: {{ licencia.estado if licencia.estado else 'Pendiente' }}
    </li>
    {% endfor %}
</ul>
{% else %}
<p>No hay licencias aprobadas.</p>
{% endif %}

<h3>Solicitudes de licencia:</h3>
{% if solicitudes_licencia %}
<ul>
    {% for solicitud in solicitudes_licencia %}
    <li>
        Fecha solicitud: {{ solicitud.fecha_solicitud.strftime('%Y-%m-%d') if solicitud.fecha_solicitud else 'Sin fecha'
        }},
        Tipo: {{ solicitud.tipo_licencia.nombre if solicitud.tipo_licencia else 'No definido' }},
        Estado: {{ solicitud.estado if solicitud.estado else 'Pendiente' }}
    </li>
    {% endfor %}
</ul>
{% else %}
<p>No hay solicitudes de licencia.</p>
{% endif %}


<h3>Historial Laboral:</h3>
{% if historial_laboral %}
<table class="table table-bordered table-hover">
    <thead>
        <tr>
            <th>Cargo</th>
            <th>Fecha Inicio</th>
            <th>Fecha Fin</th>
        </tr>
    </thead>
    <tbody>
        {% for h in historial_laboral %}
        <tr>
            <td>{{ h.cargo }}</td>
            <td>{{ h.fecha_inicio.strftime('%Y-%m-%d') if h.fecha_inicio else 'Sin fecha' }}</td>
            <td>{{ h.fecha_fin.strftime('%Y-%m-%d') if h.fecha_fin else 'Actual' }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<p>No hay historial laboral registrado.</p>
{% endif %}

<a href="#" onclick="window.print();" class="btn btn-primary no-print">Imprimir</a>
<a href="{{ url_for('historial_director.index_director') }}" class="btn btn-secondary no-print">Volver</a>

<style>
    @media print {
        .no-print {
            display: none !important;
        }
    }
</style>
{% endblock %}